using concRt
using Test

# test eirrc 
@testset "fit_eirrc" begin
    data = [7.746720258212705, 8.480719432981955, 8.326951744058404, 7.7084576380183, 9.522542336229806, 8.22919522225484, 7.906042278483086, 8.016161975227881, 8.055971726781609, 8.819137047777467, 8.179845943869427, 9.279987578665471, 10.493308139257781, 10.498784254098249, 10.359961194000313, 8.802043095255964, 8.658683720219935, 10.407716261375677, 9.562010052413433, 9.572933636668596, 9.810236509280717, 9.529538351099378, 9.606958835944363, 10.33373735063861, 10.454358918316276, 12.687789317183594, 10.879005936665019, 11.472330502871284, 11.42509332111049, 10.836315803793013, 11.753878352804922, 12.24372098423675, 11.441463477127217, 12.039611772364472, 11.994925346113881, 11.421859039344847, 11.662524295797986, 12.132078592100816, 12.36739157884099, 11.207390512792545, 13.939139664587803, 11.67228151814884, 12.305443344851344, 11.652963769537978, 12.52499119641147, 10.15098973813077, 10.301342643705967, 11.315204256603586, 10.822579353758904, 11.423893912796611, 8.877297032146474, 9.868682732684386, 11.677275082214337, 9.664438057659842, 9.456560228610122, 8.297094886066049, 11.63793474320416, 9.963509369805475, 9.814093426587796, 10.650048635744225, 7.760443284702742, 9.220419026988418, 9.566534885765293, 9.75819531406432, 6.742666627808629, 9.302003729393757, 8.431357289385941, 8.424470996239146, 8.635627711759703, 8.010481012378698, 7.644463266811531, 9.144591640141767, 8.116733236400394, 8.497013334863428, 9.195438329879707, 7.260509177702956, 7.432949104566088, 7.748803578883565, 8.209380361988687, 9.787682891722085, 9.287805446125777, 9.06301679444012, 8.709117305538767, 9.115113049814772, 12.0081478296988, 11.091696118275841, 8.399849059625485, 9.25751120331899, 10.588553873934334, 10.84952994108758, 11.362717693808072, 10.83312061625471, 10.938392060327013, 9.9747251180477, 11.158229620287273, 10.477395133827393, 11.312086556360518, 12.492828690230684, 17.222996238098514, 11.199481628721603, 11.882759110190548, 13.227626348863572, 12.372266711020266, 11.2037923706911, 11.248767146912249, 11.358252400952868, 11.072307235036785, 12.458166584779136, 13.02467986812451, 11.583984047046274, 11.886627944369401, 12.274290531773627, 10.741145575001338, 11.921335679020281, 11.639298935555031, 11.277655396341062, 11.226755000043555, 10.144965403584157, 10.455721138253244, 10.894380334635159, 10.376376511120041, 10.278972784347662, 10.490546359657424, 10.409027105649022, 9.53711256494809, 9.547372625111267, 10.900252403468027, 8.556230565735524, 9.335585837372944, 8.497105330924146, 9.056661511548988, 10.346700574121568, 7.795380924142961, 8.291718447005291, 8.542178796259117, 7.760823907673502, 8.248996678636445, 7.684755231945694, 8.773794107619311, 9.427876447322427, 8.77799363433733, 7.05860803445159, 7.701201752898667, 8.3400785632305, 7.99938378428006, 9.733777533988846, 8.82036128859379, 9.813708420543572, 8.85997810549913, 11.939800800814599, 8.64686338774508, 9.837687904759164, 9.647048283111113, 9.978698447144358, 9.959804912774242, 10.38982553845095, 9.422874646289713, 10.453034616257083, 11.335564798813458, 11.589513066511726, 11.23785811960504, 11.725042480337823, 11.513491954267774, 13.744317027548522, 11.419770503343141, 12.838468834567818, 11.954943091049845, 11.895032463422703, 13.956851269981982, 13.015612839171927, 11.881339995109759, 11.794715530354559, 9.796804116824976, 10.634394437870236, 12.631668919386676, 11.093364072222792, 11.962586751651514, 11.22415883807657, 11.694035193344565, 10.96766077961786, 11.07626119644181, 11.43381180157355, 11.34839293426723, 10.89736800047957, 11.599513938033423, 10.839955101370387, 11.342115750477927, 10.448215762455147, 8.517253389184134, 10.547763641665275, 11.011401283982684, 9.169992344712222, 9.72548594328518, 9.086925509787893, 8.552849864465156, 8.553641362028749, 8.924628482232514, 8.996387717810435, 8.375933346000442, 8.733997127256908, 7.907993436265366]
    obstimes = [1.0, 3.0, 5.0, 7.0, 9.0, 11.0, 13.0, 15.0, 17.0, 19.0, 21.0, 23.0, 25.0, 27.0, 29.0, 31.0, 33.0, 35.0, 37.0, 39.0, 41.0, 43.0, 45.0, 47.0, 49.0, 51.0, 53.0, 55.0, 57.0, 59.0, 61.0, 63.0, 65.0, 67.0, 69.0, 71.0, 73.0, 75.0, 77.0, 79.0, 81.0, 83.0, 85.0, 87.0, 89.0, 91.0, 93.0, 95.0, 97.0, 99.0, 101.0, 103.0, 105.0, 107.0, 109.0, 111.0, 113.0, 115.0, 117.0, 119.0, 121.0, 123.0, 125.0, 127.0, 129.0, 131.0, 133.0, 1.0, 3.0, 5.0, 7.0, 9.0, 11.0, 13.0, 15.0, 17.0, 19.0, 21.0, 23.0, 25.0, 27.0, 29.0, 31.0, 33.0, 35.0, 37.0, 39.0, 41.0, 43.0, 45.0, 47.0, 49.0, 51.0, 53.0, 55.0, 57.0, 59.0, 61.0, 63.0, 65.0, 67.0, 69.0, 71.0, 73.0, 75.0, 77.0, 79.0, 81.0, 83.0, 85.0, 87.0, 89.0, 91.0, 93.0, 95.0, 97.0, 99.0, 101.0, 103.0, 105.0, 107.0, 109.0, 111.0, 113.0, 115.0, 117.0, 119.0, 121.0, 123.0, 125.0, 127.0, 129.0, 131.0, 133.0, 1.0, 3.0, 5.0, 7.0, 9.0, 11.0, 13.0, 15.0, 17.0, 19.0, 21.0, 23.0, 25.0, 27.0, 29.0, 31.0, 33.0, 35.0, 37.0, 39.0, 41.0, 43.0, 45.0, 47.0, 49.0, 51.0, 53.0, 55.0, 57.0, 59.0, 61.0, 63.0, 65.0, 67.0, 69.0, 71.0, 73.0, 75.0, 77.0, 79.0, 81.0, 83.0, 85.0, 87.0, 89.0, 91.0, 93.0, 95.0, 97.0, 99.0, 101.0, 103.0, 105.0, 107.0, 109.0, 111.0, 113.0, 115.0, 117.0, 119.0, 121.0, 123.0, 125.0, 127.0, 129.0, 131.0, 133.0]
    param_change_times = [7.0, 14.0, 21.0, 28.0, 35.0, 42.0, 49.0, 56.0, 63.0, 70.0, 77.0, 84.0, 91.0, 98.0, 105.0, 112.0, 119.0, 126.0]
    priors_only = false
    n_samples::Int64 = 10
    n_chains::Int64 = 1
    @test length(concRt.fit_eirrc_closed(data, obstimes, param_change_times, priors_only, n_samples, n_chains)) == 10
end

@testset "readme" begin 
    using concRt
    data = [7.746720258212705, 8.480719432981955, 8.326951744058404, 7.7084576380183, 9.522542336229806, 8.22919522225484, 7.906042278483086, 8.016161975227881, 8.055971726781609, 8.819137047777467, 8.179845943869427, 9.279987578665471, 10.493308139257781, 10.498784254098249]
    obstimes = [1.0, 3.0, 5.0, 7.0, 9.0, 11.0, 13.0, 15.0, 17.0, 19.0, 21.0, 23.0, 25.0, 27.0]
    param_change_times = [7.0, 14.0, 21.0]
    priors_only = false
    n_samples::Int64 = 10
    n_chains::Int64 = 1
    @test length(concRt.fit_eirrc_closed(data, obstimes, param_change_times, priors_only, n_samples, n_chains)) == 10
end 

# test eir 
@testset "fit_eir" begin 
    data = [75, 108, 115, 145, 268, 510, 901, 1178, 2112, 2151, 2212, 1780, 1338, 882, 590, 338, 199, 90, 77]
    obstimes = [1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0, 11.0, 12.0, 13.0, 14.0, 15.0, 16.0, 17.0, 18.0, 19.0]
    param_change_times = [1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0, 11.0, 12.0, 13.0, 14.0, 15.0, 16.0, 17.0, 18.0]
    priors_only = false
    n_samples::Int64 = 10
    n_chains::Int64 = 1
    @test length(concRt.fit_eir_closed(data, obstimes, param_change_times, priors_only,  n_samples, n_chains)) == 10
end 

@testset "fit_seir" begin 
    data = [75, 108, 115, 145, 268, 510, 901, 1178, 2112, 2151, 2212, 1780, 1338, 882, 590, 338, 199, 90, 77]
    obstimes = [1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0, 11.0, 12.0, 13.0, 14.0, 15.0, 16.0, 17.0, 18.0, 19.0]
    param_change_times = [1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0, 11.0, 12.0, 13.0, 14.0, 15.0, 16.0, 17.0, 18.0]
    priors_only = false
    extra_ode_precision = true 
    n_samples::Int64 = 10
    n_chains::Int64 = 1
    @test length(concRt.fit_seir(data, obstimes, param_change_times, extra_ode_precision, priors_only,  n_samples, n_chains)) == 10
end 

@testset "fit_seirr" begin
    data = [7.746720258212705, 8.480719432981955, 8.326951744058404, 7.7084576380183, 9.522542336229806, 8.22919522225484, 7.906042278483086, 8.016161975227881, 8.055971726781609, 8.819137047777467, 8.179845943869427, 9.279987578665471, 10.493308139257781, 10.498784254098249, 10.359961194000313, 8.802043095255964, 8.658683720219935, 10.407716261375677, 9.562010052413433, 9.572933636668596, 9.810236509280717, 9.529538351099378, 9.606958835944363, 10.33373735063861, 10.454358918316276, 12.687789317183594, 10.879005936665019, 11.472330502871284, 11.42509332111049, 10.836315803793013, 11.753878352804922, 12.24372098423675, 11.441463477127217, 12.039611772364472, 11.994925346113881, 11.421859039344847, 11.662524295797986, 12.132078592100816, 12.36739157884099, 11.207390512792545, 13.939139664587803, 11.67228151814884, 12.305443344851344, 11.652963769537978, 12.52499119641147, 10.15098973813077, 10.301342643705967, 11.315204256603586, 10.822579353758904, 11.423893912796611, 8.877297032146474, 9.868682732684386, 11.677275082214337, 9.664438057659842, 9.456560228610122, 8.297094886066049, 11.63793474320416, 9.963509369805475, 9.814093426587796, 10.650048635744225, 7.760443284702742, 9.220419026988418, 9.566534885765293, 9.75819531406432, 6.742666627808629, 9.302003729393757, 8.431357289385941, 8.424470996239146, 8.635627711759703, 8.010481012378698, 7.644463266811531, 9.144591640141767, 8.116733236400394, 8.497013334863428, 9.195438329879707, 7.260509177702956, 7.432949104566088, 7.748803578883565, 8.209380361988687, 9.787682891722085, 9.287805446125777, 9.06301679444012, 8.709117305538767, 9.115113049814772, 12.0081478296988, 11.091696118275841, 8.399849059625485, 9.25751120331899, 10.588553873934334, 10.84952994108758, 11.362717693808072, 10.83312061625471, 10.938392060327013, 9.9747251180477, 11.158229620287273, 10.477395133827393, 11.312086556360518, 12.492828690230684, 17.222996238098514, 11.199481628721603, 11.882759110190548, 13.227626348863572, 12.372266711020266, 11.2037923706911, 11.248767146912249, 11.358252400952868, 11.072307235036785, 12.458166584779136, 13.02467986812451, 11.583984047046274, 11.886627944369401, 12.274290531773627, 10.741145575001338, 11.921335679020281, 11.639298935555031, 11.277655396341062, 11.226755000043555, 10.144965403584157, 10.455721138253244, 10.894380334635159, 10.376376511120041, 10.278972784347662, 10.490546359657424, 10.409027105649022, 9.53711256494809, 9.547372625111267, 10.900252403468027, 8.556230565735524, 9.335585837372944, 8.497105330924146, 9.056661511548988, 10.346700574121568, 7.795380924142961, 8.291718447005291, 8.542178796259117, 7.760823907673502, 8.248996678636445, 7.684755231945694, 8.773794107619311, 9.427876447322427, 8.77799363433733, 7.05860803445159, 7.701201752898667, 8.3400785632305, 7.99938378428006, 9.733777533988846, 8.82036128859379, 9.813708420543572, 8.85997810549913, 11.939800800814599, 8.64686338774508, 9.837687904759164, 9.647048283111113, 9.978698447144358, 9.959804912774242, 10.38982553845095, 9.422874646289713, 10.453034616257083, 11.335564798813458, 11.589513066511726, 11.23785811960504, 11.725042480337823, 11.513491954267774, 13.744317027548522, 11.419770503343141, 12.838468834567818, 11.954943091049845, 11.895032463422703, 13.956851269981982, 13.015612839171927, 11.881339995109759, 11.794715530354559, 9.796804116824976, 10.634394437870236, 12.631668919386676, 11.093364072222792, 11.962586751651514, 11.22415883807657, 11.694035193344565, 10.96766077961786, 11.07626119644181, 11.43381180157355, 11.34839293426723, 10.89736800047957, 11.599513938033423, 10.839955101370387, 11.342115750477927, 10.448215762455147, 8.517253389184134, 10.547763641665275, 11.011401283982684, 9.169992344712222, 9.72548594328518, 9.086925509787893, 8.552849864465156, 8.553641362028749, 8.924628482232514, 8.996387717810435, 8.375933346000442, 8.733997127256908, 7.907993436265366]
    obstimes = [1.0, 3.0, 5.0, 7.0, 9.0, 11.0, 13.0, 15.0, 17.0, 19.0, 21.0, 23.0, 25.0, 27.0, 29.0, 31.0, 33.0, 35.0, 37.0, 39.0, 41.0, 43.0, 45.0, 47.0, 49.0, 51.0, 53.0, 55.0, 57.0, 59.0, 61.0, 63.0, 65.0, 67.0, 69.0, 71.0, 73.0, 75.0, 77.0, 79.0, 81.0, 83.0, 85.0, 87.0, 89.0, 91.0, 93.0, 95.0, 97.0, 99.0, 101.0, 103.0, 105.0, 107.0, 109.0, 111.0, 113.0, 115.0, 117.0, 119.0, 121.0, 123.0, 125.0, 127.0, 129.0, 131.0, 133.0, 1.0, 3.0, 5.0, 7.0, 9.0, 11.0, 13.0, 15.0, 17.0, 19.0, 21.0, 23.0, 25.0, 27.0, 29.0, 31.0, 33.0, 35.0, 37.0, 39.0, 41.0, 43.0, 45.0, 47.0, 49.0, 51.0, 53.0, 55.0, 57.0, 59.0, 61.0, 63.0, 65.0, 67.0, 69.0, 71.0, 73.0, 75.0, 77.0, 79.0, 81.0, 83.0, 85.0, 87.0, 89.0, 91.0, 93.0, 95.0, 97.0, 99.0, 101.0, 103.0, 105.0, 107.0, 109.0, 111.0, 113.0, 115.0, 117.0, 119.0, 121.0, 123.0, 125.0, 127.0, 129.0, 131.0, 133.0, 1.0, 3.0, 5.0, 7.0, 9.0, 11.0, 13.0, 15.0, 17.0, 19.0, 21.0, 23.0, 25.0, 27.0, 29.0, 31.0, 33.0, 35.0, 37.0, 39.0, 41.0, 43.0, 45.0, 47.0, 49.0, 51.0, 53.0, 55.0, 57.0, 59.0, 61.0, 63.0, 65.0, 67.0, 69.0, 71.0, 73.0, 75.0, 77.0, 79.0, 81.0, 83.0, 85.0, 87.0, 89.0, 91.0, 93.0, 95.0, 97.0, 99.0, 101.0, 103.0, 105.0, 107.0, 109.0, 111.0, 113.0, 115.0, 117.0, 119.0, 121.0, 123.0, 125.0, 127.0, 129.0, 131.0, 133.0]
    param_change_times = [7.0, 14.0, 21.0, 28.0, 35.0, 42.0, 49.0, 56.0, 63.0, 70.0, 77.0, 84.0, 91.0, 98.0, 105.0, 112.0, 119.0, 126.0]
    priors_only = false
    extra_ode_precision = true 
    n_samples::Int64 = 10
    n_chains::Int64 = 1
    @test length(concRt.fit_seirr(data, obstimes, param_change_times, extra_ode_precision, priors_only, n_samples, n_chains)) == 10
end
